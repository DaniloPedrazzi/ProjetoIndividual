<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Individual project for SPTECH Celeste Themed">
    <title>Celeste: Home</title>
    <link rel="stylesheet" href="./css/global.css">
    <link rel="stylesheet" href="./css/leaderboard.css">
</head>
<body onload="carregarLeaderboard()">
    <div id="header"></div>
    <h1 class="title">Leaderboard</h1>
    <div class="categories">
        <button onclick="changeCategory()" class="category selected">Any%</button>
        <button onclick="changeCategory()" class="category">All Red Berries</button>
        <button onclick="changeCategory()" class="category">True Ending</button>
        <button onclick="changeCategory()" class="category">All Hearts</button>
        <button onclick="changeCategory()" class="category">100%</button>
        <button onclick="changeCategory()" class="category">Farewell</button>
    </div>
    <div id="containerLeaderboard">
    </div>
</body>
</html>

<script>
    var speedruns = [];
    function changeCategory() {
        // FrontEnd
        var categories = document.getElementsByClassName("category");
        for (var i = 0; i < categories.length; i++) {
            categories[i].classList.remove("selected");
        }
        event.target.classList.add("selected");

        // BackEnd
        var category = event.target.innerHTML;
    }

    function carregarLeaderboard() {
        fetch("/speedruns/listar", {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        }).then(function (resposta) {
            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    speedruns = json;
                    plotarEntries();
                });
            } else {
                console.log("Houve um erro ao tentar realizar o login!");
                resposta.text().then(texto => {
                    console.error(texto);
                });
            }
        }).catch(function (erro) {
            console.log(erro);
        })
    }

    function plotarEntries(){
        for (let i = 0; i < speedruns.length; i++) {
            containerLeaderboard.innerHTML += `
            <div class="entry">
                <div class="left">
                    <p class="position">${i + 1}</p>
                    <img src="./assets/img/${speedruns[i].pais}.png" alt="" class="flag">
                    <p class="userName">${speedruns[i].username}</p>
                </div>
                <div class="right">
                    <p class="time">${speedruns[i].tempo}</p>
                    <p class="date">${speedruns[i].dataSpeedrun}</p>
                    <p class="platform">${speedruns[i].plataforma}</p>
                </div>
            </div>`
        }
    }
</script>

<!-- Header loader -->
<script src="header.js"></script>